<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.kosmo.project_back.address.mapper.AddressMapper">

    <select id="selectAddressesByUserId" 
        resultType="kr.co.kosmo.project_back.address.dto.AddressDto">
        SELECT 
            id,
            user_id as userId,
            recipient,
            postcode,
            address,
            detail_address as detailAddress,
            recipient_phone as recipientPhone,
            is_default as isDefault
        FROM Bg_Address
        WHERE user_id = #{userId}
        ORDER BY is_default DESC, id DESC
    </select>

    <insert id="insertAddress"
            parameterType="kr.co.kosmo.project_back.address.dto.AddressDto"
            useGeneratedKeys="true" 
            keyProperty="id">
        INSERT INTO Bg_Address
        (
            user_id,
            recipient,
            postcode,
            address,
            detail_address,
            recipient_phone,
            is_default
        )
        VALUES
        (
            #{userId},
            #{recipient},
            #{postcode},
            #{address},
            #{detailAddress},
            #{recipientPhone},
            #{isDefault}
        )
    </insert>

    <select id="findExistingAddress" resultType="kr.co.kosmo.project_back.address.dto.AddressDto">
        SELECT id, user_id as userId, recipient, postcode, address, detail_address as detailAddress 
        FROM Bg_Address
        WHERE user_id = #{userId} 
            AND postcode = #{postcode}
            AND address = #{address}
            AND detail_address = #{detailAddress}
        LIMIT 1
    </select>

</mapper>
