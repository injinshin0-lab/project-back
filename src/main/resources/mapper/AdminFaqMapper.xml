<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.kosmo.project_back.admin.mapper.AdminFaqMapper">

    <select id="countFaqList" parameterType="kr.co.kosmo.project_back.admin.dto.FaqSearchDto" resultType="int">
        SELECT COUNT(*)
        FROM Bg_FAQ
        <where>
            <if test="keyword != null and keyword != ''">
                AND (title LIKE '%' || #{keyword} || '%' 
                     OR content LIKE '%' || #{keyword} || '%')
            </if>
        </where>
    </select>

    <select id="findFaqList" parameterType="kr.co.kosmo.project_back.admin.dto.FaqSearchDto"
            resultType="kr.co.kosmo.project_back.admin.dto.FaqDto">
        SELECT
            id AS faqId,
            title,
            content,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM Bg_FAQ
        <where>
            <if test="keyword != null and keyword != ''">
                AND (title LIKE '%' || #{keyword} || '%' 
                     OR content LIKE '%' || #{keyword} || '%')
            </if>
        </where>
        ORDER BY id DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <select id="findByFaqId" parameterType="int"
            resultType="kr.co.kosmo.project_back.admin.dto.FaqDto">
        SELECT
            id AS faqId,
            title,
            content,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM Bg_FAQ
        WHERE id = #{faqId}
    </select>

    <insert id="insertFaq" parameterType="kr.co.kosmo.project_back.admin.dto.FaqDto"
            useGeneratedKeys="true" keyProperty="faqId">
        INSERT INTO Bg_FAQ (title, content, created_at)
        VALUES (#{title}, #{content}, datetime('now'))
    </insert>

    <update id="updateFaq" parameterType="kr.co.kosmo.project_back.admin.dto.FaqDto">
        UPDATE Bg_FAQ
        SET title = #{title},
            content = #{content},
            updated_at = datetime('now')
        WHERE id = #{faqId}
    </update>

    <delete id="deleteFaq" parameterType="int">
        DELETE FROM Bg_FAQ WHERE id = #{faqId}
    </delete>

</mapper>

